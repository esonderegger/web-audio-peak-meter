var webAudioPeakMeter=function(){"use strict";function o(t){return 20*(e=10,t=t,Math.log(t)/Math.log(e));var e}var l,s,d,c,f,h,p={borderSize:2,fontSize:9,backgroundColor:"black",tickColor:"#ddd",labelColor:"#ddd",gradient:["red 1%","#ff0 16%","lime 45%","#080 100%"],dbRange:48,dbTickSize:6,maskTransition:"0.1s",audioMeterStandard:"peak-sample"},u=!0,g=1,y=[],v=[],b=[],x=[],S=[],a=[],C=[],m=4,z=[],M=.99999,r=function(n){return[256,512,1024,2048,4096,8192,16384].reduce((t,e)=>Math.abs(e-n)<Math.abs(t-n)?e:t)},k=function(t){var e=Math.floor(p.dbRange/p.dbTickSize),n=0;if(u)for(var o=p.fontSize+p.borderSize,r=0;r<e;r++){var i=document.createElement("div");t.appendChild(i),i.style.width=l+"px",i.style.textAlign="right",i.style.color=p.tickColor,i.style.fontSize=p.fontSize+"px",i.style.position="absolute",i.style.top=o+"px",i.textContent=n+"",n-=p.dbTickSize,o+=c/e}else{l=f/e;for(var a=2*p.fontSize,r=0;r<e;r++){i=document.createElement("div");t.appendChild(i),i.style.width=l+"px",i.style.textAlign="right",i.style.color=p.tickColor,i.style.fontSize=p.fontSize+"px",i.style.position="absolute",i.style.right=a+"px",i.textContent=n+"",n-=p.dbTickSize,a+=l}}},w=function(t,e,n,o,r){var i=document.createElement("div");return t.appendChild(i),i.style.width=e+"px",i.style.height=n+"px",i.style.position="absolute",i.style.top=o+"px",r=u?(i.style.left=r+"px","linear-gradient(to bottom, "+p.gradient.join(", ")+")"):(i.style.left=p.borderSize+"px","linear-gradient(to left, "+p.gradient.join(", ")+")"),i.style.backgroundImage=r,i},T=function(t,e,n){var o=document.createElement("div");return t.appendChild(o),o.style.textAlign="center",o.style.color=p.labelColor,o.style.fontSize=p.fontSize+"px",o.style.position="absolute",o.textContent="-∞",u?(o.style.width=e+"px",o.style.top=p.borderSize+"px",o.style.left=n+"px"):(o.style.width=2*p.fontSize+"px",o.style.right=p.borderSize+"px",o.style.top=.25*e+n+"px"),o},I=function(t,e,n,o,r){var i=document.createElement("div");return t.appendChild(i),i.style.position="absolute",u?(i.style.width=e+"px",i.style.height=c+"px",i.style.top=n+"px",i.style.left=o+"px"):(i.style.width=f+"px",i.style.height=e+"px",i.style.top=o+"px",i.style.right=2*p.fontSize+"px"),i.style.backgroundColor=p.backgroundColor,r&&(i.style.transition=u?"height "+p.maskTransition:"width "+p.maskTransition),i},E=function(t){for(var t=t.inputBuffer,e=[],e=("true-peak"==p.audioMeterStandard?P:i)(t),n=0;n<g;n++)x[n]=function(t){var e=u?c:f;if(0===t)return e;var n=-1*p.dbRange,n=Math.floor(o(t)*e/n);return e<n?e:n}(e[n]),e[n]>v[n]&&(v[n]=e[n],S[n]=o(v[n]).toFixed(1))},i=function(t){for(var e=[],n=t.numberOfChannels,o=0;o<n;o++){e[o]=0;for(var r=t.getChannelData(o),i=0;i<r.length;i++)Math.abs(r[i])>e[o]&&(e[o]=Math.abs(r[i]))}return e},P=function(t){var e,n=t.numberOfChannels;z.length<=0&&(console.log("Initialing TP values for "+n+"channels"),z=j(n,0),e=Math.pow(10,-2),M=Math.pow(e,1/(1.7*t.sampleRate)),console.log("Initialized with decayFactor "+M));for(var o=0;o<n;o++)for(var r=t.getChannelData(o),i=R(r,t.sampleRate),a=0;a<i.length;a++)z[o]=z[o]*M,Math.abs(i[a])>z[o]&&(z[o]=Math.abs(i[a]));return z},R=function(t,e){var n=[];a.length<=0&&(console.log("Initialing filter components for ITU-R BS.1770, fs: "+e),96e3<=e&&(m=2),a=A(33),C=j(a.length,0),console.log("Initialized lpfCoefficients lpfCoefficients=["+a.join(",")+"], and lpfBuffer: ["+C.join(",")+"]"));for(var o=0;o<t.length;o++)var r=B(t[o]),n=n.concat(r);return n},A=function(t){for(var e=[],n=1/(4*m),o=Math.floor((t-1)/2),r=-o;r<=o;r++){var i=0;i=(.54+.46*Math.cos(2*Math.PI*r/t))*(i=0==r?2*n:Math.sin(2*Math.PI*n*r)/(Math.PI*r))*m,e.push(i)}return e},j=function(t,e){for(var n=[],o=0;o<t;o++)n[o]=e;return n},B=function(t){var e=[];C.push(t),C.length>=a.length&&C.shift();for(var n=0;n<m;n++){for(var o=0,r=0,i=n;i<a.length;i+=m)r+=a[i]*C[C.length-1-o],o++;e.push(r)}return e},F=function(){for(var t=0;t<g;t++)u?y[t].style.height=x[t]+"px":y[t].style.width=x[t]+"px",b[t].textContent=S[t];window.requestAnimationFrame(F)};return{createMeterNode:function(t,e){var n=t.channelCount,o=.02*t.sampleRate*t.channelCount,n=e.createScriptProcessor(r(o),n,n);return t.connect(n).connect(e.destination),n},createMeter:function(t,e,n){!function(t){for(var e in t)t.hasOwnProperty(e)&&(p[e]=t[e]);l=2*p.fontSize,h=1.5*p.fontSize+p.borderSize}(n),s=t.clientWidth,d=t.clientHeight;var o=(n=t,(t=document.createElement("div")).style.position="relative",t.style.width=s+"px",t.style.height=d+"px",t.style.backgroundColor=p.backgroundColor,n.appendChild(t),t);d<s&&(u=!1),c=d-h-p.borderSize,f=s-l-p.borderSize,k(o),w(o,f,c,h,l),g=e.channelCount;var r=f/g;u||(r=c/g);var i=l;u||(i=h);for(var a=0;a<g;a++)I(o,p.borderSize,h,i,!1),y[a]=I(o,r,h,i,p.maskTransition),v[a]=0,b[a]=T(o,r,i),i+=r,x[a]=0,S[a]="-∞";e.onaudioprocess=E,o.addEventListener("click",function(){for(var t=0;t<g;t++)v[t]=0,S[t]="-∞"},!1),F()}}}();
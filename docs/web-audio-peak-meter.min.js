var webAudioPeakMeter=function(){"use strict";function r(e){return 20*(t=10,e=e,Math.log(e)/Math.log(t));var t}var l,s,d,c,f,h,p={borderSize:2,fontSize:9,backgroundColor:"black",tickColor:"#ddd",labelColor:"#ddd",gradient:["red 1%","#ff0 16%","lime 45%","#080 100%"],dbRange:48,dbTickSize:6,maskTransition:"0.1s",audioMeterStandard:"peak-sample",showPerformance:!1},u=!0,g=1,y=[],v=[],b=[],x=[],m=[],S=[],z=void 0,C=4,k=[],M=.99999,i=function(n){return[256,512,1024,2048,4096,8192,16384].reduce((e,t)=>Math.abs(t-n)<Math.abs(e-n)?t:e)},w=function(e){var t=Math.floor(p.dbRange/p.dbTickSize),n=0;if(u)for(var o=p.fontSize+p.borderSize,r=0;r<t;r++){var i=document.createElement("div");e.appendChild(i),i.style.width=l+"px",i.style.textAlign="right",i.style.color=p.tickColor,i.style.fontSize=p.fontSize+"px",i.style.position="absolute",i.style.top=o+"px",i.textContent=n+"",n-=p.dbTickSize,o+=c/t}else{l=f/t;for(var a=2*p.fontSize,r=0;r<t;r++){i=document.createElement("div");e.appendChild(i),i.style.width=l+"px",i.style.textAlign="right",i.style.color=p.tickColor,i.style.fontSize=p.fontSize+"px",i.style.position="absolute",i.style.right=a+"px",i.textContent=n+"",n-=p.dbTickSize,a+=l}}},T=function(e,t,n,o,r){var i=document.createElement("div");return e.appendChild(i),i.style.width=t+"px",i.style.height=n+"px",i.style.position="absolute",i.style.top=o+"px",r=u?(i.style.left=r+"px","linear-gradient(to bottom, "+p.gradient.join(", ")+")"):(i.style.left=p.borderSize+"px","linear-gradient(to left, "+p.gradient.join(", ")+")"),i.style.backgroundImage=r,i},I=function(e,t,n){var o=document.createElement("div");return e.appendChild(o),o.style.textAlign="center",o.style.color=p.labelColor,o.style.fontSize=p.fontSize+"px",o.style.position="absolute",o.textContent="-∞",u?(o.style.width=t+"px",o.style.top=p.borderSize+"px",o.style.left=n+"px"):(o.style.width=2*p.fontSize+"px",o.style.right=p.borderSize+"px",o.style.top=.25*t+n+"px"),o},P=function(e,t,n,o,r){var i=document.createElement("div");return e.appendChild(i),i.style.position="absolute",u?(i.style.width=t+"px",i.style.height=c+"px",i.style.top=n+"px",i.style.left=o+"px"):(i.style.width=f+"px",i.style.height=t+"px",i.style.top=o+"px",i.style.right=2*p.fontSize+"px"),i.style.backgroundColor=p.backgroundColor,r&&(i.style.transition=u?"height "+p.maskTransition:"width "+p.maskTransition),i},E=function(e){var t=e.inputBuffer,n=[],e=Date.now(),n=("true-peak"==p.audioMeterStandard?R:a)(t);p.showPerformance&&console.log("Time to calculate peaks: "+(Date.now()-e)+"ms");for(var o=0;o<g;o++)x[o]=function(e){var t=u?c:f;if(0===e)return t;var n=-1*p.dbRange,n=Math.floor(r(e)*t/n);return t<n?t:n}(n[o]),n[o]>v[o]&&(v[o]=n[o],m[o]=r(v[o]).toFixed(1))},a=function(e){for(var t=[],n=e.numberOfChannels,o=0;o<n;o++){t[o]=0;for(var r=e.getChannelData(o),i=0;i<r.length;i++)Math.abs(r[i])>t[o]&&(t[o]=Math.abs(r[i]))}return t},R=function(e){var t,n=e.numberOfChannels;if(k.length<=0&&(console.log("Initialing TP values for "+n+"channels"),k=D(n,0),t=Math.pow(10,-2),M=Math.pow(t,1/(1.7*e.sampleRate)),console.log("Initialized with decayFactor "+M)),void 0===z){z=[];for(var o=0;o<n;o++)z.push([])}for(o=0;o<n;o++)for(var r=e.getChannelData(o),i=A(r,e.sampleRate,o),a=0;a<i.length;a++)k[o]=k[o]*M,Math.abs(i[a])>k[o]&&(k[o]=Math.abs(i[a]));return k},A=function(e,t,n){var o=[];S.length<=0&&(console.log("Initialing filter components for ITU-R BS.1770, fs: "+t),96e3<=t&&(C=2),S=B(33),console.log("Initialized lpfCoefficients lpfCoefficients=["+S.join(",")+"], and lpfBuffer")),z[n].length<=0&&(z[n]=D(S.length,0),console.log("Initialized lpfBuffer for channel index "+n));for(var r=0;r<e.length;r++)var i=j(e[r],n),o=o.concat(i);return o},B=function(e){for(var t=[],n=1/(4*C),o=Math.floor((e-1)/2),r=-o;r<=o;r++){var i=0;i=(.54+.46*Math.cos(2*Math.PI*r/e))*(i=0==r?2*n:Math.sin(2*Math.PI*n*r)/(Math.PI*r))*C,t.push(i)}return t},D=function(e,t){for(var n=[],o=0;o<e;o++)n[o]=t;return n},j=function(e,t){var n=[],o=z[t];o.push(e),o.length>=S.length&&o.shift();for(var r=0;r<C;r++){for(var i=0,a=0,l=r;l<S.length;l+=C)a+=S[l]*o[o.length-1-i],i++;n.push(a)}return n},F=function(){for(var e=0;e<g;e++)u?y[e].style.height=x[e]+"px":y[e].style.width=x[e]+"px",b[e].textContent=m[e];window.requestAnimationFrame(F)};return{createMeterNode:function(e,t){var n=e.channelCount,o=.02*e.sampleRate*e.channelCount,n=t.createScriptProcessor(i(o),n,n);return e.connect(n).connect(t.destination),n},createMeter:function(e,t,n){!function(e){for(var t in e)e.hasOwnProperty(t)&&(p[t]=e[t]);l=2*p.fontSize,h=1.5*p.fontSize+p.borderSize}(n),s=e.clientWidth,d=e.clientHeight;var o=(n=e,(e=document.createElement("div")).style.position="relative",e.style.width=s+"px",e.style.height=d+"px",e.style.backgroundColor=p.backgroundColor,n.appendChild(e),e);d<s&&(u=!1),c=d-h-p.borderSize,f=s-l-p.borderSize,w(o),T(o,f,c,h,l),g=t.channelCount;var r=f/g;u||(r=c/g);var i=l;u||(i=h);for(var a=0;a<g;a++)P(o,p.borderSize,h,i,!1),y[a]=P(o,r,h,i,p.maskTransition),v[a]=0,b[a]=I(o,r,i),i+=r,x[a]=0,m[a]="-∞";t.onaudioprocess=E,o.addEventListener("click",function(){for(var e=0;e<g;e++)v[e]=0,m[e]="-∞"},!1),F()}}}();